pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- zumber
-- zomble number game
-- skagogames 2023. made in skago.

#include player.p8
#include enemy.p8
#include camerashake.p8
#include countdown.p8
#include introscene.p8

-- locals
local player = playercontroller.new()
local player_home = player_house.new()
runningtime = 0

current_screen = 0
game_state = "intro"

local wave = 
{
    min = 0.1,
    max = 0.5,
    speed = 5
}

function _init()
    player.start()

end

function _update60()

    if game_state == "intro" then
        update_intro()

        if iswaitended() then
            game_state = "main_menu"
        end

    elseif game_state == "main_menu" then

        if btn(üÖæÔ∏è) or btn(‚ùé) then
            game_state = "countdown"
        end

    elseif game_state == "countdown" then
        countdown_func()
    elseif game_state == "ingame" then
        player.update()

        enemy_update_all(player_home.get_num_1(), player_home.get_num_2(), player_home)
        enemy_attack_all(player.current_number_1,player.current_number_2)

        if count(enemyclone) == 0 then

            player_home.wave+=1
            
            wave.min += 0.1
            wave.max += 0.1
            wave.speed += 1

            init_enemy(wave.min,wave.max,wave.speed)
        end

        player_home.update()
    elseif game_state == "game_ended" or game_state == "game_over" then
        if btn(üÖæÔ∏è) or btn(‚ùé) then
            extcmd("reset")
        end
    end
end

function _draw()

    if game_state == "intro" then
        cls()
        draw_intro()
    elseif game_state == "main_menu" then
        cls()

        runningtime += 1/stat(8)
        local y = sin(runningtime) * 3
        spr(42,40,35 + y,6,1)

        print("press üÖæÔ∏è or ‚ùé",35,50,7)
        print("skagogames. made in skago.",12,110,1)
    elseif game_state == "countdown" then
        cls()
        countdown_draw()
    elseif game_state == "ingame" then
        cls(current_screen)

        if current_screen > 0 then
            current_screen = 0
        end 

        player.draw()
        player_home.draw()
        enemy_draw_all()
        shakescreen()
    elseif game_state == "game_ended" then
        cls()

        runningtime += 1/stat(8)
        local x = cos(runningtime) * 3
        local y = sin(runningtime) * 3

        print("wave clear!",40 + x,40 + y,rnd(16))
        spr(29,1,110,3,1)
        print("press üÖæÔ∏è or ‚ùé restart",2,120,7)
        
    elseif game_state == "game_over" then
        cls()

        runningtime += 1/stat(8)
        local x = cos(runningtime) * 8
        local y = sin(runningtime) * 8

        for i=1,5 do
            print("game over!!!!!",rnd(127) + x,rnd(127) + y,8)
        end 

        spr(29,1,110,3,1)
        print("press üÖæÔ∏è or ‚ùé restart",2,120,7)
    end
end
__gfx__
000000000007700007777770077777700770770007777770077777700777777007777770077777700000000000000000077777700aaaaaa00bbbbbb003333330
0000000000777000077777700777777007707700077777700777777007777770077777700777777000007770cccccc0a077777700aaaaaa00bbbbbb003333330
0070070000777000000007700000077007707700077000000770000000000770077007700770077000077770cccccc0a077007700aa00aa00bb00bb003300330
0007700000077000077777700777777007777770077777700777777000000770077777700777777000777770cccccc0a077007700aa00aa00bb00bb003300330
0007700000077000077777700777777007777770077777700777777000000770077777700777777007777770cccccc0a077007700aa00aa00bb00bb003300330
0070070000077000077000000000077000007700000007700770077000000770077007700000077077777770cccccc0a077007700aa00aa00bb00bb003300330
0000000000777700077777700777777000007700077777700777777000000770077777700777777077777770cccccc0a077777700aaaaaa00bbbbbb003333330
00000000007777000777777007777770000077000777777007777770000007700777777007777770777777700000000a077777700aaaaaa00bbbbbb003333330
00007770000aa0000aaaaaa00aaaaaa00aa0aa000aaaaaa00aaaaaa00aaaaaa00aaaaaa00aaaaaa0777777777777770a00000000077777000777777007777700
0000777000aaa0000aaaaaa00aaaaaa00aa0aa000aaaaaa00aaaaaa00aaaaaa00aaaaaa00aaaaaa0777777777777770a07777770077777707777777077777770
0000770000aaa00000000aa000000aa00aa0aa000aa000000aa0000000000aa00aa00aa00aa00aa0777777777777770a00000000077007707700000077000770
00007700000aa0000aaaaaa00aaaaaa00aaaaaa00aaaaaa00aaaaaa000000aa00aaaaaa00aaaaaa0077777777777700a00077000077007007777777000000770
00007700000aa0000aaaaaa00aaaaaa00aaaaaa00aaaaaa00aaaaaa000000aa00aaaaaa00aaaaaa0007777777777000a00777700077777707777777000077700
00007700000aa0000aa0000000000aa00000aa0000000aa00aa00aa000000aa00aa00aa000000aa0000777777770000a07777770077007707700000000770000
0000777000aaaa000aaaaaa00aaaaaa00000aa000aaaaaa00aaaaaa000000aa00aaaaaa00aaaaaa0000077777700000a00077000077007707777777000000000
0000777000aaaa000aaaaaa00aaaaaa00000aa000aaaaaa00aaaaaa000000aa00aaaaaa00aaaaaa0000000000000000000077000077007700777777000770000
07770000000bb0000bbbbbb00bbbbbb00bb0bb000bbbbbb00bbbbbb00bbbbbb00bbbbbb00bbbbbb00b3bbbb00770007700700007007777000777707777700000
0777000000bbb0000bbbbbb00bbbbbb00bb0bb000bbbbbb00bbbbbb00bbbbbb00bbbbbb00bbbbbb00bbbbbb00770007707770077707777707777707707700000
0077000000bbb00000000bb000000bb00bb0bb000bb000000bb0000000000bb00bb00bb00bb00bb00000b3000770007707707707707000707000007707700000
00770000000bb0000bbbbbb00bbbbbb00bbbbbb00bbbbbb00bbbbbb000000bb00bbbbbb00bbbbbb0000bb0070770007707707707707777007777707777770000
00770000000bb0000bbbbbb00bbbbbb00bbbbbb00bbbbbb00bbbbbb000000bb00bbbbbb00bbbbbb000bb00000770007707707707707000707000007700770000
00770000000bb0000bb0000000000bb00000bb0000000bb00bb00bb000000bb00bb00bb000000bb00bbbbbb00777777707707707707777707777707700770000
0777000000bbbb000bbbbbb00bbbbbb00000bb000bbbbbb00bbbbbb000000bb00bbbbbb00bbbbbb00b3bb3300077777007707707707777000777707700770000
0777000000bbbb000bbbbbb00bbbbbb00000bb000bbbbbb00bbbbbb000000bb00bbbbbb00bbbbbb0000000000000000000000000000000000000000000000000
000000000003300003333330033333300330330003333330033333300333333003333330033333300000aaa00aaa00000000bbb00bbb00000000333003330000
000000000033300003333330033333300330330003333330033333300333333003333330033333300000aaa00aaa00000000bbb00bbb00000000333003330000
000000000033300000000330000003300330330003300000033000000000033003300330033003300000aa0000aa00000000bb0000bb00000000330000330000
000000000003300003333330033333300333333003333330033333300000033003333330033333300000aa0000aa00000000bb0000bb00000000330000330000
000000000003300003333330033333300333333003333330033333300000033003333330033333300000aa0000aa00000000bb0000bb00000000330000330000
000000000003300003300000000003300000330000000330033003300000033003300330000003300000aa0000aa00000000bb0000bb00000000330000330000
000000000033330003333330033333300000330003333330033333300000033003333330033333300000aaa00aaa00000000bbb00bbb00000000333003330000
000000000033330003333330033333300000330003333330033333300000033003333330033333300000aaa00aaa00000000bbb00bbb00000000333003330000
__sfx__
000b00000000000000345503455000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003a5503a5503a5503a5003a5003a5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000003b6501b650266503a65000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00100000376503d6502e6500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000033650286502065019650116500e6500b65008650056500365002650000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
